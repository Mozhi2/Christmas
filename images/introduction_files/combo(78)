YUI.add("like-engagement-item-view",(function(e,i){var t=require("hermes-core/flog")(i);e.namespace("Views")[this.name]=e.Base.create("like-engagement-item-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){this.set("isActiveViewAgnostic",!0),this.config=this.processParams(i),this.photoCardHelper=new e.PhotoCardHelper(this.appContext),this.likesHelper=new e.LikesHelper(this.appContext,{}),this.signedIn=this.appContext.getViewer().signedIn},processParams:function(e){return{photoId:(e=Object.assign({engagementModelName:"photo-engagement-models"},e,e.subviewParams?e.subviewParams["like-engagement-item-view"]:{})).photoId,theme:e.theme,showCount:e.showCount,size:e.size,isPadded:e.isPadded,engagementModelName:e.engagementModelName}},loadState:function(){var e=this;return this.appContext.getModel(this.config.engagementModelName,this.config.photoId).then((function(i){e.engagementModel=i}))},buildContainer:function(){this.setContainerWithTemplate("like-engagement-item",Object.assign({engagement:this.photoCardHelper.convertEngagementModel(this.engagementModel)},this.config))},activate:function(){var e=this,i=this.get("container");this.likeNode=i.one(".like-engagement-item"),this.countNode=this.likeNode.one(".like-engagement-count"),this.registerEventHandler(this.likeNode.on("click",this.handleLikeClick.bind(this))),this.registerEventHandler(this.engagementModel.on("valuesChanged",(function(i){i.reactions&&e.reload()}))),this.fire("activated")},handleLikeClick:function(e){var i=this,n=i.engagementModel,o=n.getValue("reactions").like,s=o.didViewerReact;if(!this.isTogglingLike){if(!(o=this.likesHelper.toggleLikeLocal(!s,{engagementModel:n})))return;this.isTogglingLike=!0,this.likesHelper.updateLikeEngagementItemNode(this.likeNode,o),this.likesHelper.updateReactionRemote({engagementModel:n}).then((function(e){i.isTogglingLike=!1})).catch((function(e){if(i.isTogglingLike=!1,3!==e.code){var o=this.likesHelper.toggleLikeLocal(s,{engagementModel:n});i.likesHelper.updateLikeEngagementItemNode(i.likeNode,o)}t.error("Error liking photo",{err:e}),i.isTogglingLike=!1}))}},showCountNode:function(e){this.countNode.toggleClass("hidden",!e)},reload:function(){this.detachRegisteredEvents(),this.buildContainer(),this.activate()}})}),"@VERSION@",{requires:["flickr-view","hermes-template-like-engagement-item","likes-helper","photo-card-helper"],optionalRequires:["hermes-core"],langBundles:["common","likes"]});YUI.add("hermes-template-stuff-creation-view",(function(t,n){var e=t.Template.Handlebars.revive({1:function(t,n,e,l,a){return"large"},3:function(t,n,e,l,a){return'\t\t<div role="button" class="stuff-creation-sort-dropdown-button">\n\t\t\t\t<div class="menu-title"></div>\n\t\t\t\t<div class="arrow">\n\t\t\t\t\t<svg class="icon icon-dropdown_arrow"><use xlink:href="#icon-dropdown_arrow"></use></svg>\n\t\t\t\t</div>\n\t\t\t</div>\n'},5:function(t,n,e,l,a){return'<div class="error-message create-error hidden"></div>'},compiler:[8,">= 4.3.0"],main:function(t,n,e,l,a){var i,o,r=null!=n?n:t.nullContext||{},c=t.hooks.helperMissing,s="function",u=t.escapeExpression,d=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'<div class="stuff-creation-container '+(null!=(i=d(e,"if").call(r,null!=n?d(n,"isLarge"):n,{name:"if",hash:{},fn:t.program(1,a,0),inverse:t.noop,data:a,loc:{start:{line:1,column:37},end:{line:1,column:64}}}))?i:"")+'">\n\t<header>\n\t\t<h1 class="stuff-creation-heading">'+u(typeof(o=null!=(o=d(e,"heading")||(null!=n?d(n,"heading"):n))?o:c)===s?o.call(r,{name:"heading",hash:{},data:a,loc:{start:{line:3,column:37},end:{line:3,column:48}}}):o)+'</h1>\n\t\t<svg class="close-x-button"><use xlink:href="#icon-close"></use></svg>\n\t</header>\n\t<div class="input-item title-input-item">\n\t\t<input class="input-field stuff-creation-title" type="text" placeholder="'+u(typeof(o=null!=(o=d(e,"placeholderTitle")||(null!=n?d(n,"placeholderTitle"):n))?o:c)===s?o.call(r,{name:"placeholderTitle",hash:{},data:a,loc:{start:{line:7,column:75},end:{line:7,column:95}}}):o)+'">\n\t\t<div class="error-message title-error"></div>\n\t</div>\n\t<textarea class="input-field stuff-creation-description" placeholder="'+u(typeof(o=null!=(o=d(e,"placeholderDescription")||(null!=n?d(n,"placeholderDescription"):n))?o:c)===s?o.call(r,{name:"placeholderDescription",hash:{},data:a,loc:{start:{line:10,column:71},end:{line:10,column:97}}}):o)+'"></textarea>\n'+(null!=(i=d(e,"if").call(r,null!=n?d(n,"sortLabel"):n,{name:"if",hash:{},fn:t.program(3,a,0),inverse:t.noop,data:a,loc:{start:{line:11,column:1},end:{line:18,column:8}}}))?i:"")+'\t<div class="create-footer">\n\t\t'+(null!=(i=d(e,"if").call(r,null!=n?d(n,"isLarge"):n,{name:"if",hash:{},fn:t.noop,inverse:t.program(5,a,0),data:a,loc:{start:{line:20,column:2},end:{line:20,column:77}}}))?i:"")+'\n\t\t<div class="buttons">\n\t\t\t'+(null!=(i=d(e,"if").call(r,null!=n?d(n,"isLarge"):n,{name:"if",hash:{},fn:t.program(5,a,0),inverse:t.noop,data:a,loc:{start:{line:22,column:3},end:{line:22,column:78}}}))?i:"")+'\n\t\t\t<button class="alt button mini button-cancel">'+u(typeof(o=null!=(o=d(e,"cancelText")||(null!=n?d(n,"cancelText"):n))?o:c)===s?o.call(r,{name:"cancelText",hash:{},data:a,loc:{start:{line:23,column:49},end:{line:23,column:63}}}):o)+'</button>\n\t\t\t<button class="button mini button-action">'+u(typeof(o=null!=(o=d(e,"actionText")||(null!=n?d(n,"actionText"):n))?o:c)===s?o.call(r,{name:"actionText",hash:{},data:a,loc:{start:{line:24,column:45},end:{line:24,column:59}}}):o)+"</button>\n\t\t</div>\n\t</div>\n</div>\n"},useData:!0}),l={};t.Array.each([],(function(n){var e=t.Template.get("hermes/"+n);e&&(l[n]=e)})),t.Template.register("hermes/stuff-creation-view",(function(n,a){return(a=a||{}).partials=a.partials?t.merge(l,a.partials):l,e(n,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("stuff-creation-view",(function(t,e){t.namespace("Views")[this.name]=t.Base.create("stuff-creation-view",t.FlickrView,[],{initializer:function(t){return this.params=t,this.heading=t.heading,this.placeholderTitle=t.placeholderTitle,this.placeholderDescription=t.placeholderDescription,this.sortLabel=t.sortLabel,this.sortType=t.sortType,this.defaultSortTypeName=t.defaultSortTypeName,this.sortItems=t.sortItems,this.cancelText=t.cancelText,this.actionText=t.actionText,this.inlineCreation=t.inlineCreation,this},buildContainer:function(){var t={heading:this.heading,placeholderTitle:this.placeholderTitle,placeholderDescription:this.placeholderDescription,cancelText:this.cancelText,actionText:this.actionText,isLarge:this.params.useLargeLayout};return this.sortLabel&&(t.sortLabel=this.sortLabel),this.setContainerWithTemplate("stuff-creation-view",t),this},activate:function(){this.isCreating=!1;var t=this.get("container");if(this.sortLabel){this.sortMenuButton=t.one(".stuff-creation-sort-dropdown-button"),this.sortMenuTitle=this.sortMenuButton.one(".menu-title"),this.sortMenuArrow=this.sortMenuButton.one(".arrow"),this.registerEventHandler(this.sortMenuButton.on("click",(()=>this.handleSortMenuClick()))),this.appContext.viewportData.getWidth()<=700?this.sortMenuTitle.set("text",`${this.sortLabel}`):this.sortMenuTitle.set("text",`${this.sortLabel} ${this.defaultSortTypeName}`)}return this},showError:function(t,e,i){i&&t.set("text",i),e?t.removeClass("hidden"):t.addClass("hidden")},showTitleError:function(t,e){this.titleItemNode.toggleClass("error",t),e&&this.titleErrorNode.set("text",e)},destructor:function(){this.closeTimer&&clearTimeout(this.closeTimer)},resetView:function(){this.buildContainer(),this.activate()},createCuration:function(){var e=this;return this.isCreating?t.Promise.reject():(this.isCreating=!0,this.actionButton.setAttribute("disabled"),this.createNewAndAddPhoto().then((function(t){return e.isCreating=!1,e.actionButton.removeAttribute("disabled"),t})).catch((function(t){throw e.isCreating=!1,e.actionButton.removeAttribute("disabled"),t})))},focusInitial:function(){},handleSortMenuClick:function(){const e=this.sortItems.map((t=>({...t,isSelected:this.sortType===t.value})));this.dropdown=new t.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:this.sortMenuArrow,keyboardAnchorElement:this.sortMenuButton,closeOnScroll:!0,menuItems:e,preferBottom:!0}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",(async t=>{this.appContext.viewportData.getWidth()<=700?this.sortMenuTitle.set("text",`${this.sortLabel}`):this.sortMenuTitle.set("text",`${this.sortLabel} ${t.menuItem.text}`),this.sortType=t.menuItem.value,this.dropdown.close(),this.handleSortMenuSelected(t)})))}})}),"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-stuff-creation-view"]});YUI.add("hermes-template-drag-drop-photo-item",(function(t,a){var e=t.Template.Handlebars.revive({1:function(t,a,e,l,n){return"is-video"},3:function(t,a,e,l,n){var r,o=t.lookupProperty||function(t,a){if(Object.prototype.hasOwnProperty.call(t,a))return t[a]};return null!=(r=t.invokePartial(o(l,"photo-card-overlay-icon"),a,{name:"photo-card-overlay-icon",hash:{type:"video"},data:n,indent:"\t\t\t",helpers:e,partials:l,decorators:t.decorators}))?r:""},compiler:[8,">= 4.3.0"],main:function(t,a,e,l,n){var r,o,i=null!=a?a:t.nullContext||{},s=t.hooks.helperMissing,d="function",c=t.escapeExpression,p=t.lookupProperty||function(t,a){if(Object.prototype.hasOwnProperty.call(t,a))return t[a]};return'<div class="drag-drop-item">\n\t<div class="drag-drop-content '+(null!=(r=p(e,"if").call(i,null!=a?p(a,"isVideo"):a,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:2,column:31},end:{line:2,column:61}}}))?r:"")+'">\n\t\t<div class="photo" data-img-src-for-defer="'+c(typeof(o=null!=(o=p(e,"displayUrl")||(null!=a?p(a,"displayUrl"):a))?o:s)===d?o.call(i,{name:"displayUrl",hash:{},data:n,loc:{start:{line:3,column:45},end:{line:3,column:59}}}):o)+'">\n\t\t</div>\n'+(null!=(r=p(e,"if").call(i,null!=a?p(a,"isVideo"):a,{name:"if",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n,loc:{start:{line:5,column:2},end:{line:7,column:9}}}))?r:"")+'\t\t<div class="sub-photo-info-bar">\n\t\t\t<div class="details-container">\n\t\t\t\t<div class="details">\n\t\t\t\t\t<span draggable="false" class="detail title">'+c(typeof(o=null!=(o=p(e,"title")||(null!=a?p(a,"title"):a))?o:s)===d?o.call(i,{name:"title",hash:{},data:n,loc:{start:{line:11,column:50},end:{line:11,column:59}}}):o)+'</span>\n\t\t\t\t\t<span draggable="false" class="detail attribution">'+c(t.lambda(null!=(r=null!=a?p(a,"owner"):a)?p(r,"displayname"):r,a))+"</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n"},usePartial:!0,useData:!0}),l={};t.Array.each(["photo-card-overlay-icon"],(function(a){var e=t.Template.get("hermes/"+a);e&&(l[a]=e)})),t.Template.register("hermes/drag-drop-photo-item",(function(a,n){return(n=n||{}).partials=n.partials?t.merge(l,n.partials):l,e(a,n)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-photo-card-overlay-icon"]});YUI.add("hermes-template-drag-drop-album-item",(function(t,n){var a=t.Template.Handlebars.revive({1:function(t,n,a,l,e){var o,i=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'\t\t\t\t\t\t\t<span class="metadot">&middot;</span>\n\t\t\t\t\t\t\t<span class="album-video-count">\n\t\t\t\t\t\t\t\t'+t.escapeExpression("function"==typeof(o=null!=(o=i(a,"videoCountString")||(null!=n?i(n,"videoCountString"):n))?o:t.hooks.helperMissing)?o.call(null!=n?n:t.nullContext||{},{name:"videoCountString",hash:{},data:e,loc:{start:{line:14,column:8},end:{line:14,column:28}}}):o)+"\n\t\t\t\t\t\t\t</span>\n"},compiler:[8,">= 4.3.0"],main:function(t,n,a,l,e){var o,i,s=null!=n?n:t.nullContext||{},r=t.hooks.helperMissing,u="function",p=t.escapeExpression,c=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'<div class="drag-drop-item">\n\t<div class="drag-drop-content">\n\t\t<div class="photo avatar album" data-img-src-for-defer="'+p(typeof(i=null!=(i=c(a,"displayUrl")||(null!=n?c(n,"displayUrl"):n))?i:r)===u?i.call(s,{name:"displayUrl",hash:{},data:e,loc:{start:{line:3,column:58},end:{line:3,column:72}}}):i)+'">\n\t\t</div>\n\t\t<div class="sub-photo-info-bar always-show">\n\t\t\t<div class="details-container">\n\t\t\t\t<div class="details">\n\t\t\t\t\t<span draggable="false" class="detail title">'+p(typeof(i=null!=(i=c(a,"title")||(null!=n?c(n,"title"):n))?i:r)===u?i.call(s,{name:"title",hash:{},data:e,loc:{start:{line:8,column:50},end:{line:8,column:59}}}):i)+'</span>\n\t\t\t\t\t<span draggable="false" class="detail attribution multi-attribution">\n\t\t\t\t\t\t<span class="album-photo-count">'+p(typeof(i=null!=(i=c(a,"photoCountString")||(null!=n?c(n,"photoCountString"):n))?i:r)===u?i.call(s,{name:"photoCountString",hash:{},data:e,loc:{start:{line:10,column:38},end:{line:10,column:58}}}):i)+"</span>\n"+(null!=(o=c(a,"if").call(s,null!=n?c(n,"hasVideos"):n,{name:"if",hash:{},fn:t.program(1,e,0),inverse:t.noop,data:e,loc:{start:{line:11,column:6},end:{line:16,column:13}}}))?o:"")+"\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n"},useData:!0}),l={};t.Array.each([],(function(n){var a=t.Template.get("hermes/"+n);a&&(l[n]=a)})),t.Template.register("hermes/drag-drop-album-item",(function(n,e){return(e=e||{}).partials=e.partials?t.merge(l,e.partials):l,a(n,e)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("reorder-grid-helper",(function(t,e){t.ReorderGridHelper=function(o,r,s){const i=require("hermes-core/flog")(e),a=t.mix({langBundles:["common","album-page"],appContext:o},t.Localizable),l=new t.TemplateLibraryHelper(o,{localizeLib:a});function n(e,o){let r=e,s=r.getValue("owner"),i=t.PhotoModelHelper.getSizeToFit(r.id,{width:o,height:o},{sizes:r.getValue("sizes"),includeSquare:!0,cropToFit:!0}).displayUrl;return l.getTemplate("drag-drop-photo-item")({displayUrl:i,title:r.getValue("title"),owner:{displayname:s.getValue("displayname")},isVideo:r.getValue("isVideo")})}t.ReorderGridHelper.DEFAULT_MANUAL_SORT_TYPE="manual-add-to-end",t.ReorderGridHelper.DEFAULT_SORT_TYPE="manual-add-to-end";class d{constructor({sortType:t="none"}={}){this.PER_PAGE=50,this.MAX_PER_PAGE=500,this.sortType=t,this.storedSortType=this.sortType,this.sortTypeNames={}}async load(t){const e=await this.loadCollection(this.modelParams);return this.listModel=e.listModel,this.collection=e.collection,this.currentPage=0,this.itemList=[],this.reorderedItemList=[],Promise.resolve()}async loadCollection(t){const e=await o.getModel(t.registryName,t.modelIdOrAttributes),r=e.getValue(t.collectionAttributeName);return{listModel:e,collection:r}}async loadPageFromCollection(t,e,o,r){try{const r=new Error("No more items to fetch from collection.",{cause:{noMoreItems:!0}});if(this.hasLoadedEnd)throw r;const s=await t.getPage({page:e,perPage:o});if(0===s.length)throw this.hasLoadedEnd=!0,r;return s}catch(t){return Promise.reject(t)}}async loadMore(t=(t=>t)){try{const e=await this.loadPage(++this.currentPage,this.PER_PAGE,t);return this.itemList=this.itemList.concat(e),this.reorderedItemList=this.reorderedItemList.concat(e),this.itemList.length>=this.collection.totalItems&&(this.hasLoadedEnd=!0),e}catch(t){throw this.currentPage--,t}}async loadPage(t,e,o=(t=>t)){try{let r=await this.loadPageFromCollection(this.collection,t,e,this.itemList);return r=r.filter(o),r}catch(t){throw t}}hasPredefinedSortType(){return!1}hasManualSortType(){return!1}hasNewPredefinedSortType(){return!1}hasNewManualSortType(){return!1}getSortMenuItems(){return[]}getCurrentSortTypeName(){return this.sortTypeNames[this.sortType]}setSortType(t){this.sortType=t}revertToManualSortType(){}async loadSortPreview(t){throw new Error("loadSortPreview not implemented")}async sortItems(t){throw new Error("sortItems not implemented")}async loadAllItems(t=1){const e=[];this.itemList=[],this.reorderedItemList=[],this.hasLoadedEnd=!1;for(let t=1;t<this.collection.totalItems/this.MAX_PER_PAGE+1;t++)e.push(this.loadPage(t,this.MAX_PER_PAGE).catch((t=>{if(t.cause.noMoreItems)return[];throw t})));return Promise.all(e).then((t=>(t.forEach((t=>{this.itemList=this.itemList.concat(t),this.reorderedItemList=this.reorderedItemList.concat(t),this.itemList.length>=this.collection.totalItems&&(this.hasLoadedEnd=!0)})),this.itemList)))}}return new{gallery:class extends d{constructor({galleryId:t}){super(),this.layout={maxWidth:140,itemSpacing:{horizontal:8,vertical:8}},this.modelParams={registryName:"gallery-info-models",modelIdOrAttributes:t,collectionAttributeName:"photoList"}}getItemTemplate(t){return n(t,this.layout.maxWidth)}async reorderItems(t){try{await this.listModel.reorderPhotosRemote(t);this.collection.reset(),this.collection.addPage({page:1,perPage:this.PER_PAGE,pageContent:this.reorderedItemList,totalItems:this.collection.totalItems,totalPages:this.collection.totalPages})}catch(t){return i.error("Error reordering photos",{err:t}),Promise.reject(t)}}},album:class extends d{constructor({albumId:t,sortType:e}){super({sortType:e}),this.layout={maxWidth:140,itemSpacing:{horizontal:8,vertical:8}},this.modelParams={registryName:"set-models",modelIdOrAttributes:t,collectionAttributeName:"photoPageList"},this.albumId=t,this.randomSortSeed=void 0,this.sortTypeNames={"date-taken-asc":a.intlMessage({intlName:"album-page.SORT_TAKEN_OLDEST"}),"date-taken-desc":a.intlMessage({intlName:"album-page.SORT_TAKEN_NEWEST"}),"date-posted-asc":a.intlMessage({intlName:"album-page.SORT_UPLOADED_OLDEST"}),"date-posted-desc":a.intlMessage({intlName:"album-page.SORT_UPLOADED_NEWEST"}),title:a.intlMessage({intlName:"album-page.SORT_ALPHABETICAL"}),random:a.intlMessage({intlName:"album-page.SORT_RANDOM"}),"manual-add-to-beginning":a.intlMessage({intlName:"album-page.SORT_MANUAL_BEGINNING"}),"manual-add-to-end":a.intlMessage({intlName:"album-page.SORT_MANUAL_END"})}}getItemTemplate(t){return n(t,this.layout.maxWidth)}async reorderItems(t,e){const r=this.reorderedItemList.map((t=>t.id)),s={photoset_id:this.albumId,photo_ids:r.join(","),sort_option:this.sortType};return o.callAPI("flickr.photosets.reorderPhotos",s)}async sortItems(t){const e={photoset_id:this.albumId,sort:t,seed:this.randomSortSeed},r=await o.callAPI("flickr.photosets.sortPhotos",e);return this.storedSortType=t,r}getSortMenuItems(){return Object.keys(this.sortTypeNames).map((t=>({text:this.sortTypeNames[t],value:t,isSelected:this.sortType===t,hasDivider:"manual-add-to-beginning"===t})))}async loadSortPreview(t){"random"===t&&(this.randomSortSeed=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER));const e={photoset_id:this.albumId,sort:t,preview:1,seed:this.randomSortSeed},r=o.callAPI("flickr.photosets.sortPhotos",e),s=this.loadAllItems();try{const e=await r,o=await s;let i=e&&e.photoset?e.photoset.photo:[];if(i.length&&o.length){let e=i.map((t=>o.find((e=>e.id===t.id))));return this.setSortType(t),e}}catch(t){throw t}}hasPredefinedSortType(){return!this.isManualSortType(this.sortType)}hasManualSortType(){return this.isManualSortType(this.sortType)}hasNewPredefinedSortType(){return this.sortType!==this.storedSortType&&!this.isManualSortType(this.sortType)}hasNewManualSortType(){return this.sortType!==this.storedSortType&&this.isManualSortType(this.sortType)}isManualSortType(t){return"manual-add-to-beginning"===t||"manual-add-to-end"===t}revertToManualSortType(){this.sortType=this.isManualSortType(this.storedSortType)?this.storedSortType:t.ReorderGridHelper.DEFAULT_MANUAL_SORT_TYPE}},albums:class extends d{constructor({ownerId:t}){super(),this.layout={maxWidth:180,itemSpacing:{horizontal:8,vertical:12}},this.modelParams={registryName:"sets-models",modelIdOrAttributes:t,collectionAttributeName:"albumsList"},this.ownerId=t}async load(){return await super.load(),this.albumModelRegistry=await o.getModelRegistry("set-models"),Promise.resolve()}getItemTemplate(t){let e=t,o=this.albumModelRegistry.getSizeToFit(e.id,{width:this.layout.maxWidth,height:this.layout.maxWidth}),r=o?o.displayUrl:"",s=e.getValue("photoCount"),i=e.getValue("videoCount");return l.getTemplate("drag-drop-album-item")({displayUrl:r,title:e.getValue("title"),photoCountString:a.intlMessage({intlName:"common.PHOTO_COUNT_FORMATTED",photoCount:s,countString:s}),videoCountString:a.intlMessage({intlName:"common.VIDEO_COUNT_FORMATTED",videoCount:i,countString:i}),hasVideos:i>0})}async reorderItems(t){var e={photoset_ids:this.reorderedItemList.map((t=>t.id)).join(",")};return o.callAPI("flickr.photosets.orderSets",e)}async loadMore(){return super.loadMore((function(t){return!t.getValue("isAutoUploadSet")}))}}}[r](s)}}),"@VERSION@",{requires:["event-custom","template-lib-helper","photo-model-helper","hermes-template-drag-drop-photo-item","hermes-template-drag-drop-album-item"],langBundles:["common","album-page"]});YUI.add("album-creation-view",(function(e,t){var o=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("album-creation-view",e.Views["stuff-creation-view"],[],{langBundles:this.details.langBundles,initializer:function(t){this.usePhotoSelector=!1,this.usePhotoSelector=t.usePhotoSelector||!1;let o=new e.ReorderGridHelper(this.appContext,"album",{ownerId:this.appContext.getViewer().nsid,sort:e.ReorderGridHelper.DEFAULT_SORT_TYPE}),i=this.appContext.viewportData.getWidth()<=700;return this.albumSort=e.ReorderGridHelper.DEFAULT_SORT_TYPE,t.sortType=this.albumSort,t.sortLabel=i?this.intlMessage({intlName:"album-page.SORT"}):this.intlMessage({intlName:"album-page.SORT_TYPE_LABEL"}),t.sortItems=o.getSortMenuItems(),t.defaultSortTypeName=t.sortItems.find((e=>e.value===this.albumSort)).text,t.heading=this.intlMessage({intlName:"add-to-stuff.CURATIONS_CREATE_A_NEW_ALBUM"}),t.placeholderTitle=this.intlMessage({intlName:"add-to-stuff.CURATIONS_ALBUM_NAME"}),t.placeholderDescription=this.intlMessage({intlName:"add-to-stuff.CURATIONS_DESCRIPTION_OPTIONAL"}),t.cancelText=this.intlMessage({intlName:"common.CANCEL"}),t.actionText=this.usePhotoSelector?this.intlMessage({intlName:"stats.NEXT"}):this.intlMessage({intlName:"global-nav.CREATE"}),this.photoId=t.photoId,this.dismissOnCreate=t.dismissOnCreateAlbum,this.curationType="album",this.photoIds=t.photoIds,this.titleError=this.intlMessage({intlName:"add-to-stuff.PLEASE_ENTER_ALBUM_NAME"}),this.createError=this.intlMessage({intlName:"add-to-stuff.COULDNT_SAVE_ALBUM"}),this.constructor.superclass.initializer.call(this,t)},activate:function(){var e=this.get("container");this.titleItemNode=e.one(".input-item.title-input-item"),this.titleErrorNode=e.one(".error-message.title-error"),this.createErrorNode=e.one(".error-message.create-error"),this.titleNode=e.one(".stuff-creation-title"),this.descriptionNode=e.one(".stuff-creation-description"),this.cancelButton=e.one(".button-cancel"),this.actionButton=e.one(".button-action"),this.closeButton=e.one(".close-x-button"),this.setupEvents(),this.constructor.superclass.activate.call(this,this.params)},setupEvents:function(){var e=this;this.get("container");this.registerEventHandler(this.titleNode.on("keyup",(function(){e.titleNode.get("value")&&e.showTitleError(!1)}))),this.registerEventHandler(this.cancelButton.on("click",(function(){e.fire("cancel"),e.usePhotoSelector?e.fire("readyToClose"):e.resetView()}))),this.registerEventHandler(this.closeButton.on("click",(function(){e.fire("readyToClose")}))),this.registerEventHandler(this.actionButton.on("click",(function(){e.usePhotoSelector?e.displayPhotoSelector():e.createCuration()})))},createNewAndAddPhoto:function(){var t,i=this,s=!!this.photoIds,n=this.titleNode.get("value"),r=this.descriptionNode.get("value");return n?(t={photoID:s?this.photoIds[0]:this.photoId,title:n,description:r,isMultiplePhotos:s,numberOfPhotosSelected:i.params.numberOfPhotosSelected,numberOfVideosSelected:i.params.numberOfVideosSelected},i.albumSort&&(t.sort=i.albumSort),this.appContext.getModelRegistry("set-models").then((function(e){return i.albumsModel=e,e.remote.create(t,i.appContext)})).then((function(e){var t;return s&&(t=i.photoIds.slice(1)).length>0?i.addPhotos(e.getValue("id"),t).then((function(){return e})):e})).then((function(t){if(i.titleNode.set("value",""),i.descriptionNode.set("value",""),i.fire("created",{type:i.curationType,curation:t}),e.Snowplough){var o={id:t.id,photoIds:i.photoIds},s=e.Snowplough.getAlbumContext(o);e.Snowplough.sendStructuredEvent({category:"album",action:"created"},s)}return i.params.inlineCreation?i.resetView():i.params.usePhotoSelector?(i.photoSelectorModal.close(),e.fire("albumCreation:newAlbumCreated")):i.fire("readyToClose"),t})).catch((function(t){(o.error("Error handling photo addition after album creation",{err:t}),i.usePhotoSelector)&&(new e.Views.FluidModal({appContext:i.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:i.appContext,title:i.intlMessage({intlName:"common.OOPS"}),htmlMessage:t.message,showCancelButton:!1}),hasSubviewConfigRefactor:!0}).show(),i.photoSelectorView.confirmView.setButtonState({confirm:""}));throw t}))):(i.showTitleError(!0,i.titleError),e.Promise.reject({message:i.titleError}))},addPhotos:function(t,o){for(var i=this,s=[],n=[],r=0;r<o.length;r+=500)s.push(o.slice(r,r+500<o.length?r+500:o.length));return s.forEach((function(e,o){n.push(i.albumsModel.remote.addPhoto({photoID:e.join(","),isMultiplePhotos:!0,photosSelectedIds:i.params.photosSelectedIds,videosSelectedIds:i.params.videosSelectedIds,numberOfPhotosSelected:i.params.numberOfPhotosSelected,numberOfVideosSelected:i.params.numberOfVideosSelected,setID:t,updateItemCounts:0===o},this.appContext))})),e.Promise.all(n).then((function(e){return e&&e[0]?e[0].setModel:null}))},focusInitial:function(){this.titleNode&&this.titleNode.focus()},displayPhotoSelector:function(){this.titleNode.get("value")?(this.fire("readyToClose"),this.photoSelectorView=new e.Views["photo-selector-view"]({appContext:this.appContext,enableMultiSelect:!0,enableVideos:!0,multiSelectLimit:e.config.flickr.api.max_photos_in_photoset,searchable:{yours:!0},navBarConfig:{links:[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream",selected:!0},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets"}],enableSearch:!0,breakpointConfig:[{maxWidth:700,enableSearch:!1},{maxWidth:500,enableSearch:!1}],onClose:e=>{this.photoSelectorModal.close()}},initialButtonState:{confirm:"disabled"},onConfirm:e=>{this.handlePhotoSelectorConfirm(e)}}),this.photoSelectorModal=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnEsc:!1,showCancelButton:!1,actionButtonDisabled:!0,subview:this.photoSelectorView,width:Math.round(.8*Math.max(1280,e.config.win.innerWidth)),height:Math.round(e.config.win.innerHeight-60),fullWindow:!0,hasSubviewConfigRefactor:!0,flexLayout:!0,classList:"photo-selector"}).show(),this.photoSelectorView.registerEventHandler(e.on("photoSelector:selected",(()=>{this.photoSelectorView.confirmView.setButtonState({confirm:""})}))),this.photoSelectorView.registerEventHandler(e.on("photoSelector:unselected",(e=>{e.wasLastPhotoSelected&&this.photoSelectorView.confirmView.setButtonState({confirm:"disabled"})})))):this.showTitleError(!0,this.titleError)},handlePhotoSelectorConfirm:function(){this.photoSelectorView.confirmView.setButtonState({confirm:"loading"});var e=this.photoSelectorView.get("selectionModel").getValue("photos"),t=!1,o=[],i=[];this.photoId="",this.photoIds=[],e.getList().forEach(((e,s)=>{let n=e.getValue("id");this.photoIds.push(n),e.getValue("isVideo")?(o.push(n),0===s&&(t=!0)):i.push(n)})),this.photoId=this.photoIds[0],this.params.photosSelectedIds=i,this.params.videosSelectedIds=o,this.params.numberOfPhotosSelected=i.length,this.params.numberOfVideosSelected=o.length,t?this.params.numberOfVideosSelected--:this.params.numberOfPhotosSelected--,this.createNewAndAddPhoto()},handleSortMenuSelected:function(e){this.albumSort=e.menuItem.value}})}),"@VERSION@",{requires:["flickr-view","stuff-creation-view","reorder-grid-helper"],optionalRequires:["hermes-core"],optional:["set-models"],langBundles:["more-menu-view","common","global-nav","add-to-stuff","profile","stats","album-page"]});YUI.add("gallery-creation-view",(function(e,t){var i=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("gallery-creation-view",e.Views["stuff-creation-view"],[],{langBundles:this.details.langBundles,initializer:function(e){return e.heading=this.intlMessage({intlName:"add-to-stuff.CURATIONS_CREATE_A_NEW_GALLERY"}),e.placeholderTitle=this.intlMessage({intlName:"add-to-stuff.CURATIONS_GALLERY_NAME"}),e.placeholderDescription=this.intlMessage({intlName:"add-to-stuff.CURATIONS_DESCRIPTION_OPTIONAL"}),e.cancelText=this.intlMessage({intlName:"common.CANCEL"}),e.actionText=this.intlMessage({intlName:"global-nav.CREATE"}),this.photoId=e.photoId,this.dismissOnCreate=e.dismissOnCreateGallery,this.curationType="gallery",this.titleError=this.intlMessage({intlName:"add-to-stuff.PLEASE_ENTER_GALLERY_NAME"}),this.createError=this.intlMessage({intlName:"add-to-stuff.COULDNT_SAVE_GALLERY"}),this.constructor.superclass.initializer.call(this,e)},activate:function(){var e=this.get("container");this.titleItemNode=e.one(".input-item.title-input-item"),this.titleErrorNode=e.one(".error-message.title-error"),this.createErrorNode=e.one(".error-message.create-error"),this.titleNode=e.one(".stuff-creation-title"),this.descriptionNode=e.one(".stuff-creation-description"),this.actionButton=e.one(".button-action"),this.setupEvents(),this.constructor.superclass.activate.call(this,this.params)},setupEvents:function(){var e=this,t=this.get("container");this.cancelButton=t.one(".button-cancel"),this.actionButton=t.one(".button-action"),this.closeButton=t.one(".close-x-button"),this.registerEventHandler(this.titleNode.on("keyup",(function(){e.titleNode.get("value")&&e.showTitleError(!1)}))),this.registerEventHandler(this.cancelButton.on("click",(function(){e.params.inlineCreation?(e.fire("cancel"),e.resetView()):e.fire("readyToClose")}))),this.registerEventHandler(this.closeButton.on("click",(function(){e.fire("readyToClose")}))),this.registerEventHandler(this.actionButton.on("click",(function(){e.createCuration()})))},createNewAndAddPhoto:function(){var t,r=this,o=this.titleNode.get("value"),n=this.descriptionNode.get("value");return e.rapidTracker.beacon(r.name,"galleryCreationViewCreateClick"),o?(r.showError(r.createErrorNode,!1),t={photoID:r.photoId,title:o,description:n},this.appContext.getModelRegistry("gallery-models").then((function(e){return e.remote.create(t,r.appContext)})).then((function(t){if(r.photoId&&!t.getValue("primary")&&i.error("Photo cannot be added to galleries."),r.titleNode.set("value",""),r.descriptionNode.set("value",""),r.fire("created",{type:r.curationType,curation:t}),r.params.inlineCreation?r.resetView():r.fire("readyToClose"),e.Snowplough){var o={id:t.id},n=e.Snowplough.getGalleryContext(o);e.Snowplough.sendStructuredEvent({category:"gallery",action:"created"},n)}return t})).catch((function(e){throw i.error("Error handling photo addition after gallery creation",{err:e}),r.showError(r.createErrorNode,!0,r.createError),e}))):(r.showTitleError(!0,r.titleError),e.Promise.reject({message:r.titleError}))},focusInitial:function(){this.titleNode&&this.titleNode.focus()}})}),"@VERSION@",{requires:["flickr-view","stuff-creation-view"],optionalRequires:["hermes-core"],langBundles:["more-menu-view","common","global-nav","add-to-stuff"]});