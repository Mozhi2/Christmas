YUI.add("flickr-photosets-getPhotos-fetcher",(function(e,o){"use strict";var t=require("hermes-core/flog")(o);e.namespace("ListFetchers")["flickr-photosets-getPhotos"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.photosets.getPhotos",this._processParams(t),!0),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("set-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models"),s.getModelRegistry("album-privacy-models")]).then((function(e){return r._processResponse(e,t,s)}),e.FetcherErrorLogger(o))},_processParams:function(o){o.page=o.page||1,o.perPage=o.perPage||100;var s={extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:o.perPage,page:o.page,get_user_info:1,primary_photo_extras:"url_c, url_h, url_k, url_l, url_m, url_n, url_o, url_q, url_s, url_sq, url_t, url_z, needs_interstitial, can_share",jump_to:o.withPhotoId||""};return o.gpCode&&null!==o.gpCode?(s.gp_code=o.gpCode,s.share_code=o.gpCode,s.gp_owner=o.gpOwner,t.info("Calling sets api with GP "+o.gpCode)):s.photoset_id=o.id.split("-")[0],o.includeHiddenSets&&(s.extras+=",hidden_sets",s.user_id=o.userId),o.viewAs&&(s.view_as=o.viewAs),o.filter&&(s.privacy_filter=o.filter),o.moderationFilter&&(s.moderation_filter=o.moderationFilter),s},_processResponse:function(o,t,s){var r,a,p,i,l,n=o[0],h=o[1],d=o[2],g=o[3],u=o[4],P=o[5],c=o[6],m=[],_=!1,y=!1,f=t.id;r=e.APIHelper.response.parsePerson(n.user),a=d.addOrUpdate(r);let M=n.photoset;p=e.APIHelper.response.parsePhotoset({...M,ownerModel:a}),f&&f!==n.photoset.id&&(p.id=f),"1"===n.photoset.isAutoUploadSet&&(p.canShare=!1),g.exists(t.id)&&(_=!!(i=g.getValue(t.id,"photoPageList")).hasMinBoundary&&i.hasMinBoundary(),y=!!i.hasMaxBoundary&&i.hasMaxBoundary(),m=i.getList()),l=e.APIHelper.response.parsePhotos({photos:n.photoset.photo,ownerID:n.photoset.owner,personModelRegistry:d,photoModelRegistry:h,photoEngagementModelRegistry:u,photoStatsModelRegistry:P}),p.photoPageList=e.APIHelper.response.addOrReplaceListByPage({current:m,perPage:t.perPage,pageNum:t.page,hasMax:y,hasMin:_,totalItems:n.photoset.total,newPages:l}),p.photoPageList={perPage:n.photoset.perPage,page:n.photoset.page,pageContent:l,totalItems:n.photoset.total},p.photoPageList.pageContent.length>p.photoPageList.totalItems&&(p.photoPageList.totalItems=p.photoPageList.pageContent.length);var R={id:p.id,countPhotosFamily:n.photoset.countPhotosFamily,countPhotosFriend:n.photoset.countPhotosFriend,countPhotosPublic:n.photoset.countPhotosPublic,countPhotosFriendFamily:n.photoset.countPhotosFriendFamily,totalCount:n.photoset.countPhotosAll};return c.exists(R.id)?c.setValues(t.id,R):c.add(R),g.exists(p.id)?g.setValue(t.id,"photoPageList",p.photoPageList):g.add(p),l}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optionalRequires:["hermes-core"],optional:["photo-models","person-models","set-models","photo-engagement-models","photo-stats-models"]});YUI.add("flickr-photosets-getContext-fetcher",(function(e,o){"use strict";e.namespace("ListFetchers")["flickr-photosets-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.photosets.getContext",this._processParams(t,s),!0),s.getModelRegistry("set-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then((function(e){return r._processResponse(e,t)}),(function(e){throw 2===e.code&&"Photo not in set"===e.message&&(e.notInContext=!0),e})).then(null,e.FetcherErrorLogger(o))},_processParams:function(o,t){var s={extras:e.APIHelper.request.getRebootPhotoExtras(),photo_id:o.photoId,num_prev:o.numNext,num_next:o.numPrev,get_photoset_info:1};return o.gpCode?(s.share_code=o.gpCode,s.share_owner=o.gpOwner,s.gp_code=o.gpCode,s.gp_owner=o.gpOwner):s.photoset_id=o.id,s},_processResponse:function(o,t){var s,r,n,p,h,i,a,d,g=o[0],l=o[1],u=o[2],m=o[3],c=o[4],x=o[5],y=[],M=u.proxy(t.photoId);return r=g.prevphotos,n=g.nextphotos,s=e.APIHelper.response.parsePhotos({photos:r.photo,personModelRegistry:m,photoModelRegistry:u,photoEngagementModelRegistry:c,photoStatsModelRegistry:x}),y=e.APIHelper.response.parsePhotos({photos:n.photo,personModelRegistry:m,photoModelRegistry:u,photoEngagementModelRegistry:c,photoStatsModelRegistry:x}),p=!!(i=l.getValue(t.id,"photoContextList")).hasMinBoundary&&i.hasMinBoundary(),h=!!i.hasMaxBoundary&&i.hasMaxBoundary(),a=i.getList(),d=e.APIHelper.response.addOrReplaceListByContext({model:M,next:s,prev:y.reverse(),current:a,hasMin:p,hasMax:h,numNext:t.numNext,numPrev:t.numPrev}),l.setValue(t.id,"photoContextList",d),{next:s,previous:y.reverse()}}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","photo-engagement-models","photo-stats-models"]});YUI.add("flickr-photosets-create-creator",(function(e,t){"use strict";e.namespace("ModelCreators")["flickr-photosets-create"]={run:function(o,s){var l={},p=[];return l.title=o.title,l.description=o.description,l.primary_photo_id=o.photoID,l.full_result=1,o.sort&&(l.sort=o.sort),p=[s.callAPI("flickr.photosets.create",l),s.getModelRegistry("set-models"),s.getModel("person-models",s.getViewer().nsid),s.getModel("sets-models",s.getViewer().nsid,{page:1,perPage:500}),s.getModelRegistry("photo-sets-models"),s.getModelRegistry("photo-contexts-models")],o.isMultiplePhotos||p.push(s.getModel("photo-models",o.photoID)),e.Promise.all(p).then((function(t){var s,l,p,i=t[0],r=t[1],h=t[2],d=t[3],a=t[4],u=t[5];if(i.photoset.id){o.isMultiplePhotos?o.numberOfPhotosSelected+o.numberOfVideosSelected===1?(i.photoset.photos,i.photoset.videos):i.photoset.photos?(i.photoset.photos,0):(i.photoset.videos,0):(l=t[6],i.photoset.photos,i.photoset.videos),s=e.APIHelper.response.parsePhotoset({...i.photoset,ownerModel:h,photoPageList:o.isMultiplePhotos?[]:[l],photoContextList:o.isMultiplePhotos?[]:[l]}),r.add(s),p=r.proxy(i.photoset.id);var n=d.getValue("albumsList").getList(),g=n.findIndex((e=>!e.getValue("isAutoUploadSet")));return g<0&&(g=0),n.splice(g,0,p),d.setValue("albumsList",n),a.exists(o.photoID)&&!a.getValue(o.photoID,"sets").getFromListByID(p.getValue("id"))&&(a.getValue(o.photoID,"sets").prependToList(p),a.setValue(o.photoID,"total",a.getValue(o.photoID,"total")+1)),u.exists(o.photoID)&&!u.getValue(o.photoID,"contexts").getFromListByID(p.getValue("id"))&&(u.setValue(o.photoID,"totalSets",u.getValue(o.photoID,"totalSets")+1),u.getValue(o.photoID,"contexts").appendToList(p)),p}return!1}),e.FetcherErrorLogger(t))}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","sets-models","photo-sets-models","photo-contexts-models"]});YUI.add("flickr-photosets-createHidden-creator",(function(e,o){"use strict";e.namespace("ModelCreators")["flickr-photosets-createHidden"]={run:function(t,s){var r,d={};return d.photo_ids=t.photoIds,r=[s.callAPI("flickr.photosets.createHidden",d),s.getModelRegistry("set-models"),s.getModel("person-models",s.getViewer().nsid)],e.Promise.all(r).then((function(e){var o,t=e[0],s=e[1],r=e[2];return!("ok"!==t.stat||!t.photoset.share_code)&&(o={id:t.photoset.share_code,shareCode:t.photoset.share_code,owner:r,gpCode:t.photoset.share_code,gpOwner:r.getValue("pathAlias")||r.getValue("nsid"),url:t.photoset.url,isAutoUploadSet:!1,isSharedEntity:!0,totalCount:t.photoset.count},s.add(o),s.proxy(o.id))}),e.FetcherErrorLogger(o))}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","sets-models","photo-sets-models","photo-contexts-models"]});YUI.add("flickr-photosets-editMeta-updater",(function(e,t){"use strict";var o=require("hermes-core/flog")(t);e.namespace("ModelUpdaters")["flickr-photosets-editMeta"]={run:function(o,s){var r={},i=this;return r.photoset_id=o.photosetId,r.title=o.title,r.description=o.description,o.includeHiddenSets&&(r.extras="hidden_sets"),e.Promise.all([s.callAPI("flickr.photosets.editMeta",r),s.getModelRegistry("set-models")]).then((function(e){i._processResponse(e,o,s)}),e.FetcherErrorLogger(t))},_processResponse:function(e,t,s){var r=e[0],i=e[1];if(r.photoset&&r.photoset.title&&r.photoset.description){if(!i.exists(t.photosetId))throw new Error("[flickr-photosets-editMeta-updater] - Set model cannot be updated if it does not exist");i.setValues(t.photosetId,{title:r.photoset.title.content,description:r.photoset.description.content})}else o.warn("No updated data returned from API.")}}}),"@VERSION@",{requires:["flickr-promise"],optionalRequires:["hermes-core"]});YUI.add("flickr-photosets-setPrimaryPhoto-updater",(function(r,t){"use strict";r.namespace("ModelUpdaters")["flickr-photosets-setPrimaryPhoto"]={run:function(o,e){var s={};return s.photoset_id=o.albumId,s.photo_id=o.photoId,e.callAPI("flickr.photosets.setPrimaryPhoto",s).then(null,r.FetcherErrorLogger(t))}}}),"@VERSION@",{requires:["flickr-promise"]});YUI.add("set-models",(function(t,e){var o=require("hermes-core/flog")(e);function r(t){r.superclass.constructor.call(this,t)}t.Models[this.name]=r,t.extend(r,t.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(e){return t.ListFetchers["flickr-photosets-getPhotos"].run(e,this.appContext)},create:function(e,o){return t.ModelCreators["flickr-photosets-create"].run(e,o)},createHidden:function(e,o){return t.ModelCreators["flickr-photosets-createHidden"].run(e,o)},addPhoto:function(e,o){return t.ModelCreators["flickr-photosets-addPhoto"].run(e,o)},removePhoto:function(e,o){return t.ModelCreators["flickr-photosets-removePhoto"].run(e,o)},update:function(e,o){var r=[];return"primary"in o&&(this.hasPhoto(e,o.primary.newVal)?r.push(t.ModelUpdaters["flickr-photosets-setPrimaryPhoto"].run({photoId:o.primary.newVal,albumId:e},this.appContext)):r.push(t.ModelCreators["flickr-photosets-addPhoto"].run({setID:e,photoID:o.primary.newVal},this.appContext).then((()=>t.ModelUpdaters["flickr-photosets-setPrimaryPhoto"].run({photoId:o.primary.newVal,albumId:e},this.appContext))))),r.push(t.ModelUpdaters["flickr-photosets-editMeta"].run({photosetId:e,title:o.title?o.title.newVal:this.getValue(e,"title"),description:o.description?o.description.newVal:this.getValue(e,"description")},this.appContext)),t.Promise.all(r)},setPrimaryPhoto:function(e,o){return t.ModelUpdaters["flickr-photosets-setPrimaryPhoto"].run(e,o)},delete:function(e){"string"==typeof e&&(e={setID:e});return t.ModelDeletors["flickr-photosets-delete-deletor"].run(e,this.appContext)}},addPhoto:function(t,e){return this.getValue(t,"photoPageList").hasMaxBoundary()&&this.getValue(t,"photoPageList").appendToList(e),this.getValue(t,"photoContextList").hasMaxBoundary()&&this.getValue(t,"photoContextList").appendToList(e),this},removePhoto:function(t,e){return this.getValue(t,"photoPageList").removeFromList(e.getValue("id")),this.getValue(t,"photoContextList").removeFromList(e.getValue("id")),this},removePhotoRemote:function(t,e){return this.remote.removePhoto({setID:t,photoID:e},this.appContext)},hasPhoto:function(t,e){return this.getValue(t,"photoPageList").getFromListByID(e)||this.getValue(t,"photoContextList").getFromListByID(e)},getSizeToFit:function(e,r,i){o.info("Using `getSizeToFit` is deprecated. See model comments for more details.");var n=t.PhotoModelHelper.getSizeToFit(e,r,t.merge({sizes:this.getValue(e,"primaryPhotoSizes"),includeSquare:!0,cropToFit:!0},i));return n&&(n.url=n.src),n},getLargestPrimaryPhotoSize:function(e,o){return t.PhotoModelHelper.getLargestSize(e,o)},attributes:{normalizedId:{readOnly:!0,defaultFn:function(t){return t.split("-")[0]}},displayType:{readOnly:!0,defaultFn:function(){return"set"}},title:{validator:function(e,o){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultValue:""},description:{validator:function(e,o){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultValue:""},owner:{isModel:!0},isOwner:t.PhotoModelHelper.attributes.isOwner,photoPageList:{isCollection:!0,pageFetch:{listFetcher:t.ListFetchers["flickr-photosets-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:t.ListFetchers["flickr-photosets-getContext"],listItemIdField:"photoId"}},photoCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}},videoCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}},publicPhotosCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}},totalCount:{readOnly:!0,derivedBy:["photoCount","videoCount"],defaultFn:function(t){return this.getValue(t,"photoCount")+this.getValue(t,"videoCount")}},viewCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}},photoCountDisplay:{readOnly:!0,derivedBy:["totalCount"],defaultFn:function(t){var e=this.getValue(t,"totalCount"),o="";return 0===e?o=this.intlMessage({intlName:"models.ZERO_ITEMS"}):1===e?o=this.intlMessage({intlName:"models.ONE_ITEM"}):e>1&&(o=this.intlMessage({intlName:"models.MULTIPLE_ITEMS",items:e})),o}},photoAndVideosDisplay:{readOnly:!0,derivedBy:["photoCount","videoCount"],defaultFn:function(t){var e=this.getValue(t,"photoCount"),o=this.getValue(t,"videoCount"),r="";return 0===e&&0===o?r=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):1===e&&0===o?r=this.intlMessage({intlName:"models.ONE_PHOTO"}):e>1&&0===o?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:e}):0===e&&1===o?r=this.intlMessage({intlName:"models.ONE_VIDEO"}):1===e&&1===o?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):e>1&&1===o?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:e}):0===e&&o>1?r=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:o}):1===e&&o>1?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:o}):e>1&&o>1&&(r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:e,videos:o})),r}},sharedEntityDisplay:{readOnly:!0,derivedBy:["videoCount","photoCount","owner"],defaultFn:function(t){var e=this.getValue(t,"photoCount"),o=this.getValue(t,"videoCount"),r=this.getValue(t,"owner"),i="";return e&&!o?i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_PHOTOS_ONLY",username:r.getValue("displayname"),photoCount:parseInt(e,10)}):!e&&o?i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_VIDEOS_ONLY",username:r.getValue("displayname"),videoCount:parseInt(o,10)}):e&&o&&(i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_PHOTOS_VIDEOS",username:r.getValue("displayname"),photoCount:parseInt(e,10),videoCount:parseInt(o,10)})),i}},primary:{},primaryPhotoSizes:{},primaryNeedsInterstitial:{},bestIconURL:{readOnly:!0,derivedBy:["primaryPhotoSizes"],defaultFn:function(e){var o=t.PhotoModelHelper.getSizeToFit(e,{height:75,width:75},t.merge({sizes:this.getValue(e,"primaryPhotoSizes"),includeSquare:!0,cropToFit:!0}));return o?o.src:""}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(t){var e=this.getValue(t,"owner"),o=this.getValue(t,"isSharedEntity"),r=this.getValue(t,"normalizedId");return e&&!0===o?"/photos/"+e.getValue("pathAlias")+"/shares/"+r:e?"/photos/"+e.getValue("pathAlias")+"/albums/"+r:void 0}},isAutoUploadSet:{validator:function(e){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},isSharedEntity:{validator:function(e){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},canShare:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},canDownload:{validator:function(e){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},urlSuffix:{readOnly:!0,defaultFn:function(t){return this.getValue(t,"isSharedEntity")?"shares-"+t:"album-"+t}},gpCode:{defaultFn:function(t){return null}},gpOwner:{defaultFn:function(t){return null}},sortType:{validator:function(e,o){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultValue:""}}},{buildCompoundId:function(t,e,o){var r=t;return e&&(r+="-"+e),o&&(e||(r+="-dateposted"),r+="-"+o),r},splitCompoundId:function(t){var e=t.split("-");return{nsid:e[0],orderBy:e[1],viewAs:e[2]}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photosets-addPhoto-creator","flickr-photosets-removePhoto-deletor","flickr-photosets-delete-deletor","flickr-photosets-getPhotos-fetcher","flickr-photosets-getContext-fetcher","flickr-photosets-create-creator","flickr-photosets-createHidden-creator","flickr-photosets-editMeta-updater","flickr-photosets-setPrimaryPhoto-updater","photo-model-helper"],optionalRequires:["hermes-core"],langBundles:["models","shared-entity"]});